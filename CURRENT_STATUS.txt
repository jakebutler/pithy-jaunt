=======================================================
PITHY JAUNT - CURRENT STATUS & WHAT'S NEEDED
=======================================================

PROJECT: Task automation app that uses AI agents in Daytona workspaces to make code changes and create PRs.

REPOSITORY: https://github.com/jakebutler/pithy-jaunt

=======================================================
‚úÖ WHAT'S WORKING
=======================================================

1. Full authentication system (Supabase)
2. Task creation and management UI
3. Database (Convex) - tasks, workspaces, repos, users
4. Webhook infrastructure:
   - ngrok tunnel: https://backdoor-kristine-calflike.ngrok-free.dev
   - Webhook endpoint: /api/webhook/daytona
   - Task status updates via webhooks ‚úÖ
5. UI properly shows completed tasks with "View PR" button
6. Debug tools and scripts

=======================================================
‚ùå CRITICAL ISSUE - TASK EXECUTION DOESN'T WORK
=======================================================

ROOT CAUSE:
The app calls Daytona API to create workspaces with template "pithy-jaunt-dev", 
but this template DOESN'T EXIST in the Daytona account.

WHAT HAPPENS:
- App creates task ‚Üí status: "running"
- Daytona workspace created ‚Üí status: "Started" in Daytona dashboard
- Workspace just sits there idle (no execution script)
- No code generated, no PR created, no webhook sent back
- Task stays "running" forever

WORKSPACE CURRENTLY STUCK:
- ID: 85cb9f7c-b738-4e3b-8462-13949ecac3b3
- Status in Daytona: "Started"
- Been running 15+ minutes with no output

=======================================================
üîß WHAT NEEDS TO BE DONE
=======================================================

OPTION 1 - Create Daytona Template (Recommended)
-------------------------------------------------
Create a template called "pithy-jaunt-dev" in Daytona that runs this flow:

1. Clone repo: git clone $TARGET_REPO
2. Create branch: git checkout -b $BRANCH_NAME
3. Run AI agent to generate code changes (using $AGENT_PROMPT, $OPENAI_API_KEY)
4. Commit & push changes
5. Create PR using GitHub CLI
6. Send webhook back to app:
   POST $WEBHOOK_URL
   {
     "type": "task.completed",
     "workspaceId": "...",
     "taskId": "...",
     "branchName": "...",
     "prUrl": "...",
     "status": "success"
   }

Reference script: See /daytona/execution.sh in codebase

OPTION 2 - Use Different Execution Backend
-------------------------------------------
Replace Daytona with:
- GitHub Actions
- Modal.com
- AWS Lambda
- Vercel AI SDK + custom runner
- Any service that can: clone repo ‚Üí run AI ‚Üí create PR ‚Üí send webhook

OPTION 3 - Manual Testing (Current State)
------------------------------------------
For UI testing without real execution:
./scripts/complete-task-manually.sh <taskId> <prUrl>

=======================================================
üìã ENVIRONMENT SETUP
=======================================================

.env.local contains:
‚úÖ NEXT_PUBLIC_CONVEX_URL
‚úÖ NEXT_PUBLIC_SUPABASE_URL
‚úÖ NEXT_PUBLIC_SUPABASE_ANON_KEY
‚úÖ SUPABASE_SERVICE_ROLE_KEY
‚úÖ DAYTONA_API_URL=https://app.daytona.io/api
‚úÖ DAYTONA_API_KEY (configured)
‚úÖ GITHUB_TOKEN (for PR creation)
‚úÖ OPENAI_API_KEY (for AI code generation)
‚úÖ NEXT_PUBLIC_APP_URL=https://backdoor-kristine-calflike.ngrok-free.dev

ngrok authtoken: 35XOWKkAmsZxRSf2Om6RWSzB7h8_5GzjG5bGUwVaUBDmPmdH6

=======================================================
üöÄ HOW TO RUN
=======================================================

Terminal 1: npx convex dev
Terminal 2: npm run dev
Terminal 3: ngrok http 3000

Then create tasks at: http://localhost:3000

=======================================================
üêõ DEBUG COMMANDS
=======================================================

Check task status:
curl http://localhost:3000/api/debug/task/<taskId> | jq .

Cancel stuck task:
curl -X POST http://localhost:3000/api/admin/cancel-task/<taskId>

Reset database (delete all tasks/workspaces):
./scripts/full-reset.sh

Manually complete a task:
./scripts/complete-task-manually.sh <taskId> "https://github.com/owner/repo/pull/123"

=======================================================
üîë KEY FILES
=======================================================

lib/daytona/client.ts - Daytona API integration (line 50-67 shows env vars sent)
app/api/webhook/daytona/route.ts - Webhook receiver
app/api/task/[taskId]/execute/route.ts - Task execution starter
daytona/execution.sh - Template script for Daytona workspace
convex/tasks.ts - Task database operations

=======================================================
üéØ IMMEDIATE NEXT STEPS
=======================================================

1. Choose execution backend:
   [ ] Create Daytona template "pithy-jaunt-dev"
   [ ] Use different service (which one?)
   
2. If using Daytona:
   - Contact Daytona support about creating custom template
   - OR find their template builder in dashboard
   - Test execution script locally first
   
3. If using alternative:
   - Update lib/daytona/client.ts with new integration
   - Ensure webhook sent to: /api/webhook/daytona
   - Test end-to-end flow

=======================================================
‚úÖ VERIFICATION CHECKLIST
=======================================================

Can test these NOW (without Daytona template):
[x] User can create account
[x] User can create tasks
[x] User can execute tasks (creates workspace)
[x] Webhook endpoint receives data
[x] UI updates when task completes
[x] "View PR" button appears

Cannot test (needs execution backend):
[ ] AI agent generates code
[ ] Branch gets created
[ ] PR gets created
[ ] Real GitHub PR link in UI

=======================================================
üìû ADDITIONAL INFO
=======================================================

Daytona Dashboard: https://app.daytona.io
Workspace ID in Daytona: 85cb9f7c-b738-4e3b-8462-13949ecac3b3

Tech Stack:
- Next.js 14 (App Router)
- Convex (database)
- Supabase (auth)
- Daytona (execution - needs setup)
- ngrok (webhook tunnel)

Full documentation: See docs/TASK_EXECUTION_SETUP.md

=======================================================
END OF STATUS REPORT
=======================================================

